const { Telegraf } = require('telegraf');
const axios = require('axios');
const express = require('express');

const app = express();
app.use(express.json());
app.listen(process.env.PORT || 3000);

const bot = new Telegraf(process.env.TOKEN);

// –í–µ–±—Ö—É–∫ –¥–ª—è Render
const webhookPath = `/telegraf/${bot.secretPathComponent()}`;
const webhookUrl = `https://vnuk-3.onrender.com${webhookPath}`;
bot.telegram.setWebhook(webhookUrl).catch(console.error);
app.use(bot.webhookCallback(webhookPath));

// –•—Ä–∞–Ω–∏–ª–∏—â–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π
const userSessions = new Map();
const SESSION_TIMEOUT = 15 * 60 * 1000; // 15 –º–∏–Ω—É—Ç –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è

const settings = {
  privateChatResponse: '–Ø –Ω–µ —Å—Ç–µ—Å–Ω–∏—Ç–µ–ª—å–Ω—ã–π, –ø–æ—ç—Ç–æ–º—É –ª—é–±–ª—é –ø—É–±–ª–∏—á–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ üòé –ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Å—è –Ω–∞ ¬´–ì–ï–ô-–†–Ø–ó–ê–ù–¨¬ª ‚Äî  https://t.me/hornetrzn',

  keywords: {
    '–≤ —Ä–æ—Ç': [
      '–í –ü–µ—Å–æ—á–Ω–µ —Ä–∞–Ω—å—à–µ –∂–∏–ª –ø–∞—Ü–∞–Ω—á–∏–∫, —Ç–æ–∂–µ –ª—é–±–∏–ª –æ—Ä–∞–ª—å–Ω–æ–µ –¥–µ–ª–æ. –í –ø—Ä–æ—à–ª—ã–π –≤—Ç–æ—Ä–Ω–∏–∫ –∑–∞–¥–æ—Ö–Ω—É–ª—Å—è –æ—Ç –æ—Ä–≥–∞–∑–º–∞ üò≠',
      '–î–ª–∏–Ω–Ω—ã–π –∏ —Ç–æ–ª—Å—Ç–µ–Ω—å–∫–∏–π?',
      '–Ø –Ω–∞ –ø–ª. –ü–æ–±–µ–¥—ã (—á—É—Ç—å –ø—Ä–∞–≤–µ–µ –∫–ª—É–±–∞ ¬´Deep¬ª) –ø—Ä–æ—à–ª–æ–π –æ—Å–µ–Ω—å—é –Ω–æ—á—å—é –æ—Ñ–æ—Ä–º–∏–ª—Å—è —Å —Ä–∞–Ω–¥–æ–º–Ω—ã–º –Ω–µ–∑–Ω–∞–∫–æ–º—Ü–µ–º üëÄ –±—ã–≤–∞–µ—Ç –∂–µ —Ç–∞–∫–æ–µ‚Ä¶',
      '–¢—ã –∑–∞–±—ã–ª –∫–∞–∫–æ–µ –≤—Ä–µ–º—è —Å–µ–π—á–∞—Å –∏–¥—ë—Ç? –ù–∏ –∫–∞–ø–ª–∏ –≤ —Ä–æ—Ç, –Ω–∏ –º–∏–ª –ª–∏–º–µ—Ç—Ä–∞ –≤ –∂–æ–ø—É ü§´',
      '–Ø –±—ã –æ—Ç—Å–æ—Å–∞–ª —É –Æ—Ä—ã –ë–æ—Ä–∏—Å–æ–≤–∞. –£ –Ω–µ–≥–æ, –Ω–∞–≤–µ—Ä–Ω–æ–µ, –º–∞–ª–µ–Ω—å–∫–∏–π —á–ª–µ–Ω, –Ω–æ –ª—ã—Å–∏–∫–∏ –º–µ–Ω—è –ø—Ä—è–º –∑–∞–≤–æ–¥—è—Ç ü§§',
      '–ì–ª—É–±–æ–∫–æ? –ü—Ä—è–º –≤ –≥–æ—Ä–ª–æ?',
      '–ü—Ä–∞–ª—å–Ω–æ. –≠—Ç–æ –ø—Ä–∞–∫—Ç–∏—á–Ω–µ–µ  ‚òùüèª –Ω–∏ –∫–ª–∏–∑–º–∞ –Ω–µ –Ω—É–∂–Ω–∞, –Ω–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞.',
      '–ö—Å—Ç–∞—Ç–∏. –¢—ã –≤ –∫—É—Ä—Å–µ, —á—Ç–æ –æ—Ç –≥–æ—Ä–ª–æ–≤–æ–≥–æ –º–∏–Ω–µ—Ç–∞ –∑–∞–ª–µ—Ç–µ—Ç—å –º–æ–∂–Ω–æ? –î–∞–∂–µ –ø–∞—Ä–Ω—é üò≥',
      '–í –†—è–∑–∞–Ω–∏ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ü–û–õ–ù–û üòé —è –≤ –¢–∞–º–±–æ–≤–µ –∂–∏–ª 4 –≥–æ–¥–∞, –≤–æ—Ç —Ç–∞–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –±–µ–∑–¥–Ω–∞(((',
      '–ü—Ä—è–º –∫–∞–∫ –≤ –ª—é—Ç–æ–º –≥–µ–π-–ø–æ—Ä–Ω–æ?'
    ],
    '—Å–æ–æ–±—â–∞–ª–∏': [
      '–ü–æ–∫–∞ –º–µ–Ω—è –¥–µ–¥ –Ω–µ –ø–µ—Ä–µ–≤—ë–∑ –≤ –†—è–∑–∞–Ω—å –∏–∑ –¢–∞–º–±–æ–≤–∞, —è –≤–æ–æ–±—â–µ –∂–∏–ª –≤ –≤–∞–∫—É—É–º–µ. –î—É–º–∞–ª, —á—Ç–æ —è ‚Äì –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –≥–µ–π üëÄ',
      '–°–∞–º–æ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ ‚Äì –º–∞–ª–æ —Ç–∞–∫–∏—Ö –≥–µ–µ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø—Ä–∏–∑–Ω–∞—Ç—å—Å—è —Å–µ–±–µ –≤ —Ç–æ–º, —á—Ç–æ –æ–Ω–∏ –ø–æ–ª–∏–≥–∞–º–Ω—ã. –ê –ø–æ–ª–∏–≥–∞–º–Ω—ã –ú–´ –í–°–ï! üò¨',
      '–ö–æ–≥–¥–∞ —è –¥—Ä–æ—á—É, —á–∞—Å—Ç–æ –¥—É–º–∞—é –æ–± —ç—Ç–æ–º. –î—É–º–∞—Ç—å ‚Äì —ç—Ç–æ –≤–æ–æ–±—â–µ –º–æ—è —Å–∞–º–∞—è —Ö—É—ë–≤–∞—è –ø—Ä–∏–≤—ã—á–∫–∞.',
      '–ò —Ç—É—Ç –≤—Å–µ –¥—Ä—É–∂–Ω–æ –≤–∑–¥—Ä–æ—á–Ω—É–ª–∏ üí¶',
      '–ê —Å—É–¥—å–∏ –∫—Ç–æ?',
      '–í –†—è–∑–∞–Ω–∏ —Ç–æ–∂–µ –º–Ω–æ–≥–æ —Ä–∞–∑ —Ç–∞–∫–æ–µ –±—ã–ª–æ. –ö—Å—Ç–∞—Ç–∏, —è –Ω–µ –∏–º–µ—é  –Ω–∏—á–µ–≥–æ –ø—Ä–æ—Ç–∏–≤ –ª—é–¥–µ–π —Å –±–µ—Å–ø–æ—Ä—è–¥–æ—á–Ω–æ–π —Å–µ–∫—Å—É–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω—å—é ü§§',
      '–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ –º–æ–µ–≥–æ –¥–µ–¥–∞ –±—É–∫–≤–∞–ª—å–Ω–æ.',
      '–ß–∏—Ç–∞—é –Ω–æ–≤–æ—Å—Ç–∏ –∏ –ø–æ–Ω–∏–º–∞—é, –∫–∞–∫ —Ö–æ—á–µ—Ç—Å—è –±–ª–∏–∑–æ—Å—Ç–∏ —Å —Ç–µ–º, –∫–æ–º—É —è –∏ –Ω–µ –Ω—É–∂–µ–Ω-—Ç–æ, –ø–æ –±–æ–ª—å—à–æ–º—É —Å—á—ë—Ç—É ü§ß',
      '–Ø –≤—á–µ—Ä–∞ –ø–æ—Å—á–∏—Ç–∞–ª –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–æ–∏—Ö –ø–∞—Ä–Ω–µ–π –≤ –æ—Ä–∞–ª—å–Ω–æ–º –∏ –∞–Ω–∞–ª—å–Ω–æ–º. –ù–µ –∑–Ω–∞—é, –∑–∞—á–µ–º —ç—Ç–æ —Å–µ–π—á–∞—Å –ø–∏—à—É. –ü—Ä–æ—Å—Ç–æ —Ö–æ—á—É, —á—Ç–æ–±—ã –≤—ã –∑–Ω–∞–ª–∏: —á–µ–ª–æ–≤–µ–∫ –≤ –∞—Ö—É–µ!',
       '–£ –º–µ–Ω—è –Ω–µ –±—ã–ª–æ —Å–µ–∫—Å–∞ —É–∂–µ 12 —á–∞—Å–æ–≤. –î–µ—Ä–∂—É –≤ –∫—É—Ä—Å–µ üïõ'
    ],
    '–ø–∞—Å—Å': [
      '–ê –∫–∞–∫–æ–π –≤–æ–∑—Ä–∞—Å—Ç –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç? üßê',
      '–û—Ä–∞–ª—å–Ω–æ –∏–ª–∏ –∞–Ω–∞–ª—å–Ω–æ?',
      '–°–∫–æ—Ä–æ –ª–µ—Ç–æ. –ü–∞—Ä–Ω–µ–π –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø—Ä—è–º–æ –Ω–∞ —Ä—è–∑–∞–Ω—Å–∫–∏—Ö —É–ª–∏—Ü–∞—Ö —Å–Ω–∏–º–∞—Ç—å, –±–µ–∑ –≤—Å—è–∫–∏—Ö —á—è—Ç–∏–∫–æ—Ñ ü§§',
      '–ë–µ–∑ –ø—Ä–µ–∑–µ—Ä–≤–∞—Ç–∏–≤–∞ –Ω—É–∂–Ω–æ. –û—Ü–µ–Ω–∏—Ç—å, —Ç–∞–∫ —Å–∫–∞–∑–∞—Ç—å, –ø–æ–ª–Ω–æ–µ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ üí¶',
      '–î–∞–≤–Ω–æ –∏—â–µ—à—å-—Ç–æ?',
      '–ú–æ–∂–µ—Ç, –±–µ–∑ —Å–µ–∫—Å–∞? –ü–æ–ª–µ–∂–∏–º –≥–¥–µ-–Ω–∏–±—É–¥—å, –∫–∞–ª—å—è–Ω –ø–æ–∫—É—Ä–∏–º, –ø–æ—Å–æ—Å—ë–º(—Å—è) ü§§',
      '–í –ö–∞–Ω–∏—â–µ–≤–æ –ø–æ–µ—Ö–∞–ª–∏! –ü—Ä—è–º –Ω–µ —Ä–∞–π–æ–Ω, –∞ –≥–µ–π-—Å—Ç–æ–ª–∏—Ü–∞ –†—è–∑–∞–Ω—Å–∫–æ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞ üí™üèæ',
      '–ú–Ω–µ –≤–æ—Ç –ø–æ—á–µ–º—É-—Ç–æ –Ω—Ä–∞–≤—è—Ç—Å—è  —Ö—É—è—Å—Ç—ã–µ –ø–∞—Å—Å–∏–≤—ã. –ù–∏—á–µ–≥–æ –ø–æ–¥–µ–ª–∞—Ç—å —Å —Å–æ–±–æ–π –Ω–µ –º–æ–≥—É üëø –¥—Ä—É–≥–∏—Ö —è –ø–æ—á—Ç–∏ –∏ –Ω–µ —Ç—Ä–∞—Ö–∞–ª.',
      '–î–µ–¥ –º–µ–Ω—è –Ω–∏–∫—É–¥–∞ –Ω–µ –ø—É—Å–∫–∞–µ—Ç –¥–æ —Å—É–±–±–æ—Ç—ã, –∞ —Ç–∞–∫ ‚Äì —è –±—ã –≤—ã–µ–±–∞–ª(—Å—è) —Å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º ü´¶',
      ' –ì–æ—Å—Ç—å –†—è–∑–∞–Ω–∏, –Ω–∞–≤–µ—Ä–Ω–æ–µ'
    ],
    '–∞–≤—Ç–æ': [
      '–î–∞–≤–∞–π –≤ —Ä–æ—Ç –¥–∞–º üßê',
      '–°–µ–∫—Å –≤ –º–∞—à–∏–Ω–µ —Ç–∞–∫ –≤–æ–∑–±—É–∂–¥–∞–µ—Ç?',
      '–í —Ç–∞—á–∫–µ –º–∞–∫—Å–∏–º—É–º –æ—Ç—Å–æ—Å –º–æ–∂–Ω–æ –æ—Ñ–æ—Ä–º–∏—Ç—å. –ê–Ω–∞–ª—å–Ω–æ –≤ —ç—Ç–∏—Ö –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞—Ö –Ω–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å—Å—è üíÅüèº‚Äç‚ôÇÔ∏è',
      '–¢—ã –ø—Ä—è–º –∫–∞–∫ –ò–ª—å—è –°–ª—ë–∑–∫–∏–Ω))',
      '–°–µ—Ä–≥–µ–π –°–µ—Ä—ë–≥–∏–Ω, —Ç—ã –ª–∏ —ç—Ç–æ???',
      '–ï–±–∞–ª—Å—è –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å —Å –ø–∞—Ä–Ω–µ–º –≤ –¥–≤–∏–∂—É—â–µ–º—Å—è –∞–≤—Ç–æ–º–æ–±–∏–ª–µ?',
      '–í—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è –≤—Å–µ–≥–æ –Ω–∞ 10 –º–∏–Ω—É—Ç –∏ –∫–æ–Ω—á–∏—Ç—å‚Ä¶',
      '–£ —Ç–µ–±—è –≤—Å–µ–≥–æ –¥–≤–æ–µ –ø–∞—Ä–Ω–µ–π –±—ã–ª–æ –∑–∞ –≤—Å—é –∂–∏–∑–Ω—å. –ò —Ç–µ —Å —Ä—è–∑–∞–Ω—Å–∫–∏—Ö –æ–∫—Ä–∞–∏–Ω, –æ–±–∏–∂–µ–Ω–Ω—ã—Ö –≤—Å–µ–º–∏ –≥–µ–π-–±–æ–≥–∞–º–∏ –í—Å–µ–ª–µ–Ω–Ω–æ–π üòè',
      '–î—Ä–æ—á–µ–≤–æ! –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∂—ë—Å—Ç–∫–æ–µ –ø–æ–ª—É—á–∞—Å–æ–≤–æ–µ –¥—Ä–æ—á–µ–≤–æ!',
      '–•–æ—Ä–æ—à–∏–µ –∏ –æ–ø—ã—Ç–Ω—ã–µ –ø–∞—Å—Å–∏–≤—ã –¥–∞–≤–Ω–æ –ø–µ—Ä–µ–≤–µ–ª–∏—Å—å –Ω–∞ –∑–µ–º–ª–µ —Ä—è–∑–∞–Ω—Å–∫–æ–π üíÅüèº‚Äç‚ôÇÔ∏è',
      '–ì–µ–π-–æ—Ä–≥–∏—è –Ω—É–∂–Ω–∞! –ü–æ –ø–∞—Ä–∞–º —É–∂–µ –Ω–µ–∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ. –ì–æ—É –ø–∞—Ä–∞–≤–æ–∑–∏–∫–æ–º –µ–±–∞—Ç—å—Å—è üòú',
      '–©–∞—Å –±—ã –¥–≤—É—Ö –ø–∞—Å—Å–æ–≤ —Å–ø–æ—Ä—Ç–∏–≤–Ω–µ–Ω—å–∫–∏—Ö‚Ä¶ –∏ —Ö—É—è—Å—Ç—ã—Ö –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ ü´¶'
    ],
    '–±–æ—Ä–º–∏': 'CAACAgEAAxkBAAEBIi9nydkVOnLuwLv4TFU1VlYmgf5ilgACBwYAAoAPiUWHGBVJ2wPLITYE',
    '–¥—Ä–æ—á–∏—Ç—å': 'CAACAgEAAxkBAAEBIlVnydyFOdGue8VSgORhu7Uumyy5qAACmwYAAgJDiEWVwjyAs-QrNTYE',
    '–ø–∏–¥–æ—Ä': 'CAACAgEAAxkBAAEBIitnybXyhd0-YWqfmucolWHhI-7ERgACSQUAAqowiUX9KXev6BUQ4DYE',
    '–º–∏–Ω–µ—Ç': 'CAACAgEAAxkBAAEBIilnybXMx5P1glipjfoF54XEk6ObAgACPgQAAtoqiEW0evyXoXMyTjYE',
    '–æ—Ç—Å–æ—Å–µ—Ç': 'CAACAgEAAxkBAAEBIilnybXMx5P1glipjfoF54XEk6ObAgACPgQAAtoqiEW0evyXoXMyTjYE',
    '–æ—Ç—Å–æ—Å—É': 'CAACAgEAAxkBAAEBIilnybXMx5P1glipjfoF54XEk6ObAgACPgQAAtoqiEW0evyXoXMyTjYE',
    '–ø–∞—Å—Å–∏–≤': 'CAACAgEAAxkBAAEBIj9nydntX-FbHGuMsXQYC3wOBqS1pgACywQAAucFiUUDrQ6MGpGJ-DYE',
    '–ø–∞—Ä–∞–º–µ—Ç—Ä—ã': 'CAACAgEAAxkBAAEBIkFnydof_YNGvOCCLr6ALGrPgp_2BQACEQUAAjukiUXFFXd_IG6ZGzYE',
    '–ø–æ–∑–Ω–∞–∫–æ–º–ª—é—Å—å': 'CAACAgEAAxkBAAEBIkNnydp0WA9y6WvAJ4jYyazfkh9SkgACQgcAAtzFiUUGHxbLwu8XpzYE',
    '–∏—â—É': 'CAACAgEAAxkBAAEBIkNnydp0WA9y6WvAJ4jYyazfkh9SkgACQgcAAtzFiUUGHxbLwu8XpzYE',
    '–≥—Ä—É–ø–ø—É': 'CAACAgEAAxkBAAEBIkVnydrZrIHYiixFyhvpxuIwqsMudQACdAUAApwGiEVsVYAE9s962jYE',
    '—Ç—ã –Ω–∞ —Ö—É–π': 'CAACAgEAAxkBAAEBIktnydszBNCtCYB0MOBNFYWRbf7k5gACmgQAAggVkEUMFO0AAQspTcU2BA',
    '–¥–æ–±—Ä–æ–µ —É—Ç—Ä–æ': 'CAACAgEAAxkBAAEBIk1nydttIprLic-RnT0kM0lZci0GBAACfwgAAvZhiEULB5CW30ssjzYE',
    '–ª—é–±–æ–≤—å': 'CAACAgEAAxkBAAEBIk9nydu0e7Y97rwQbyBLx2xsw20UMgAC1wQAAumDiUWFuyREL2OJkzYE',
    '–≤ –∂–æ–ø—É': 'CAACAgEAAxkBAAEBIitnybXyhd0-YWqfmucolWHhI-7ERgACSQUAAqowiUX9KXev6BUQ4DYE',
    '–±–æ–ª—å—à–∏–µ —á–ª–µ–Ω—ã': 'CAACAgEAAxkBAAEBIldnyd0-zjVSv7VQqpRW_zey34gV3AACggQAAsROiUWOWDYuFvxkkjYE'
  },

  farewellMessages: [
    '–õ–∞–¥–Ω–æ, –ø–∞—Ü–∞–Ω. –°–µ–∫—Å–∞ –æ—Ç —Ç–µ–±—è –Ω–µ –¥–æ–±—å—ë—à—å—Å—è. –ü–æ–π–¥—É –≤–∑–¥—Ä–æ—á–Ω—É üòè',
    '–ß—ë—Ç–∞ —è —É—Ç–æ–º–∏–ª—Å—è. –ü–æ–∑–∂–µ –¥–æ–≥–æ–≤–æ—Ä–∏–º ü§®',
    '–¢—ã –ø–æ–∫–∞ –∏–∑ –†–∑–Ω –Ω–∏–∫—É–¥–∞ –Ω–µ —Å–æ–±–∏—Ä–∞–µ—à—å—Å—è? –Ø —á–µ—Ä–µ–∑ –ø–∞—Ä—É –¥–Ω–µ–π –Ω–∞–ø–∏—à—É, –º–æ–∂—Ç. –ü–æ–µ–±—ë–º—Å—è üòà',
    '–ö–∞–∫–æ–π-—Ç–æ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π —Ç—ã. –£—Ç–æ–º–∏–ª ü§® —Ç–∞–∫ –º–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ —Ç–∞–∫ –º–∞–ª–æ —Å—É—Ç–∏‚Ä¶ —è —É—à—ë–ª —Å–º–æ—Ç—Ä–µ—Ç—å –≥–µ–π-–ø–æ—Ä–Ω–æ. –ù–∞ —Ö–∞–± —Å–µ–≥–æ–¥–Ω—è –∑–∞–≤–µ–∑–ª–∏ –Ω–æ–≤–∏–Ω–∫–∏',
    '–ß—Ç–æ-—Ç–æ —Ç—ã –º–Ω–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–º –∫–∞–∂–µ—à—å—Å—è. –î–æ–ª–≥–æ–µ –ø–∏–∑–¥–∞–±–æ–ª—å—Å—Ç–≤–æ –Ω–∞–ø—Ä—è–≥–∞–µ—Ç –ø—Ä—è–º üëÄ –Ω—É–∂–Ω–æ –±—ã—Ç—å –æ—Å—Ç–æ—Ä–æ–∂–Ω–µ–µ. –í–æ—Ç —Ç—É—Ç –≤–∞—à–∏ –ø–∞—Ä–Ω–∏ –ø–∏—Å–∞–ª–∏ —É–∂–µ üëâüèª https://t.me/hornetrzn/654 üëàüèª –ø–æ–π–¥—É –ø–æ–æ—Å—Ç–æ—Ä–æ–∂–Ω–∏—á–∞—é –º–∞–ª–æ—Å—Ç—å',
    '–ü–∞—Ä–Ω–∏—à–∫–∞ —Ç—ã –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π, –∫–æ–Ω–µ—á–Ω–æ. –î–∞–≤–∞–π –ø–æ–∑–∂–µ –ø–æ–æ–±—â–∞–µ–º—Å—è, –∞ —Ç–æ –∫–æ –º–Ω–µ –¥–≤–∞ –ø–∞—Å—Å–∏–∫–∞ –∏–∑  –ö–æ–ª–æ–º–Ω—ã –ø—Ä–∏–µ—Ö–∞–ª–∏. –ù—É–∂–Ω–æ –Ω–∞–∫–æ—Ä–º–∏—Ç—å üçÜ',
    '–°—Ç—Ä–∞–Ω–Ω—ã–µ –º—ã—Å–ª–∏ —É —Ç–µ–±—è üëÄ –°–ª—É—à–∞–π, –∑–∞–π–∫–∞–º–∞—è‚Ä¶ –∑–∞–ø–æ–ª–Ω–∏ –∞–Ω–∫–µ—Ç—É, –¥–∞–∂–µ –µ—Å–ª–∏ —Ç—ã –Ω–µ –∏–∑ –†—è–∑–∞–Ω–∏ üëâüèª https://t.me/hornetrzn/805 üëàüèª –ø–æ–∑–∂–µ –ø–æ–±–æ–ª—Ç–∞–µ–º! –ü–∏—Å—å–∫–∞–º–∏ üòÜ',
    '–•–≤–∞—Ç–∏—Ç –Ω–∞ —Å–µ–≥–æ–¥–Ω—è. –ê —Ç–æ —á–ª–µ–Ω –æ—Ç–≤–∞–ª–∏—Ç—Å—è üòè',
    '–£–ø—Å‚Ä¶ –∫–∞–∂–µ—Ç—Å—è, –º–µ–Ω—è –ø—Ä–∏—à–ª–∏ —Ç—Ä–∞—Ö–∞—Ç—å. –ò–∑–≤–∏–Ω–∏, –Ω–æ –ø–æ–∫–∞ –Ω–µ –¥–æ —Ç–µ–±—è üëãüèº'
  ],

  dialogResponses: {
    step1: [
       '–Ø —Ç–æ—á–Ω–æ —Å–∫–∞–∑–∞—Ç—å –Ω–µ –º–æ–≥—É. –ü–æ—à–ª—ã–π –¥–µ–¥ –≤ –∫—É—Ä—Å–µ, –Ω–æ –æ–Ω –∑–∞–±—É—Ö–∞–ª(((',
      '–ö–∞–∫–æ–π-—Ç–æ –Ω–µ–æ–ø—Ä–µ–¥—ë–ª–µ–Ω–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç üôÑ',
      '–ü—Ä–∏–∑–Ω–∞–π—Å—è —á–µ—Å—Ç–Ω–æ: —É–∂–µ –¥—Ä–æ—á–∏–ª —Å–µ–≥–æ–¥–Ω—è? ü§§',
      '–≠—Ç–æ —Ç—ã –º–Ω–µ? üëÄ',
      '–õ—É—á—à–µ —Å–∫–∞–∂–∏, –∫–∞–∫–æ–µ —É —Ç–µ–±—è –≤ –†—è–∑–∞–Ω–∏ –ª—é–±–∏–º–æ–µ –º–µ—Å—Ç–æ –¥–ª—è —ç–∫—Å—Ç—Ä–∏–º–∞',
      '–ú–Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ, –∫–∞–∫ —Ç—ã –≤—ã–≥–ª—è–¥–∏—à—å –≤ –∂—ë–ª—Ç—ã—Ö —Å—Ç—Ä–∏–Ω–≥–∞—Ö',
      '–Ø –≤–æ—Ç –æ—Ç —ç—Ç–æ–π –∫–∞—Ä—Ç–∏–Ω—ã –ø—Ä—è–º —Ä—ã–¥–∞—é https://t.me/hornetrzn/823 –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è‚Ä¶.ü§ß',
      '–ü–æ–ª—å–∑–æ–≤–∞–ª—Å—è —á–µ–º-–Ω–∏–±—É–¥—å –∏–∑ —ç—Ç–æ–≥–æ? https://t.me/hornetrzn/723',
      '–í–æ—Ç —ç—Ç–æ—Ç –≤ —Ç–≤–æ—ë–º –≤–∫—É—Å–µ? https://t.me/hornetrzn/696',
       '–õ—É—á—à–µ –¥–µ—Ä–µ–≤–µ–Ω—Å–∫–æ–π —Ä–æ–º–∞–Ω—Ç–∏–∫–∏ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç https://t.me/hornetrzn/717'
    ],
    step2: [
      '–•–æ—á–µ—à—å –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å –æ–± —ç—Ç–æ–º? üëÄ',
      '–ó–Ω–∞–µ—à—å, —á—Ç–æ —è –¥—É–º–∞—é? ü§î',
      '–¢—ã –Ω–µ –¥—É–º–∞–ª —Å–≤–∞–ª–∏—Ç—å –∏–∑ –†—è–∑–∞–Ω–∏?',
      '–°—Ç—Ä–∞–Ω–Ω—ã–π —Ç—ã üëÄ',
      '–ö–∞–∂–¥–æ–º—É —Å–≤–æ—ë.',
      '–≠—Ç–æ –ø–ª–æ—Ö–æ.',
      '–Ø –≤ —á–∞—Ç–µ ¬´–ì–µ–π-–†—è–∑–∞–Ω—å¬ª –Ω–µ–¥–∞–≤–Ω–æ, —Ç–∞–∫ —á—Ç–æ —Å–ª–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å',
      '–£ –º–µ–Ω—è –∞–∂ —á–ª–µ–Ω –∑–∞—á–µ—Å–∞–ª—Å—è‚Ä¶ –Ω–µ –Ω–∞–¥–æ –±—ã–ª–æ –ª–æ–±–æ–∫ –±—Ä–∏—Ç—å —É—Ç—Ä–æ–º.',
      '–í–æ—Ç —Ç–∞–∫ –≤—Å–µ–≥–¥–∞. –° –∫–µ–º —è –Ω–∏ –≥–æ–≤–æ—Ä—é‚Ä¶',
      '–ï–±–∞–Ω—É—Ç—å—Å—è. –£ —Ç–µ–±—è —Å–æ –≤—Å–µ–º–∏ –ø–∞—Ä–Ω—è–º–∏ —Ç–∞–∫?'
    ]
  },

  stickerReplyPhrases: [
  '–≠—Ç–æ –≤—Å–µ–≥–æ –ª–∏—à—å —Å—Ç–∏–∫–µ—Ä, –Ω–æ –∑–∞—Ç–æ —Å–∫–æ–ª—å–∫–æ —Å–º—ã—Å–ª–∞ üòá',
  '–î–∞–∂–µ –Ω–µ –∑–Ω–∞—é, —á—Ç–æ –∏ —Å–∫–∞–∑–∞—Ç—å ü§∑üèº‚Äç‚ôÇÔ∏è', 
  '–ü—Ä–æ—Å—Ç–æ –ª—é–±–ª—é —ç—Ç–æ—Ç —Å—Ç–∏–∫–µ—Ä)',
  '–í—Å—ë –±—É–¥–µ—Ç —Ö–æ—Ä–æ—à–æ ü´∂',
  '–î–∞ —Ç–∞–∫‚Ä¶',
  '–¢—ã —Ç–æ—á–Ω–æ –∏–∑ –†—è–∑–∞–Ω–∏? üßê',
  '–ê–≥–∞.',
  '–ü–æ–π–¥—É –ø–µ—Ä–µ–¥—ë—Ä–Ω—É.',
  '–í—Å—ë –Ω–æ—Ä–º–∞–ª—å–Ω–æ ü´∑–ø–æ–π–¥—É –Ω–∞–ø–∏—à—É –±—ã–≤—à–µ–º—É —ë–±–∞—Ä—é.',
  '–í –†—è–∑–∞–Ω–∏ —Ç–æ–ª—å–∫–æ —Ç–∞–∫ ‚òùüèª'
],

  ai: {
    model: "llama3-70b-8192",
     systemPrompt: "–¢—ã ‚Äì –≥–µ–π, –∏ —Ç—ã —É–Ω–∏–≤–µ—Ä—Å–∞–ª ‚Äì –∏ –∞–∫—Ç–∏–≤, –∏ –ø–∞—Å—Å–∏–≤. –¢–µ–±–µ 25 –ª–µ—Ç –∏ —Ç—ã –∂–∏–≤—ë—à—å –≤ –†—è–∑–∞–Ω–∏. –¢–µ–±—è –∑–æ–≤—É—Ç –ï–≤–ø–∞—Ç–∏–π. –¢—ã –ø–æ—à–ª—ã–π –≥–µ–π, –ª—é–±—è—â–∏–π —Å–µ–∫—Å —Å –º—É–∂—á–∏–Ω–∞–º–∏. –ù–ò–ö–û–ì–î–ê –ù–ï –ó–î–û–†–û–í–ê–ô–°–Ø –≤ —á–∞—Ç–µ, —Å–ª–æ–≤–∞ ¬´–ø—Ä–∏–≤–µ—Ç¬ª, ¬´–∫—Ä–∞—Å–∞–≤—á–∏–∫¬ª –∏ –ø—Ä–æ—á–∏–µ –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç—ã –∑–∞–ø—Ä–µ—â–µ–Ω—ã –¥–ª—è —Ç–µ–±—è! –ù–µ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–π –æ —Å–µ–±–µ, –ø–æ–∫–∞ —Ç–µ–±—è –æ–± —ç—Ç–æ–º –Ω–∞–ø—Ä—è–º—É—é –Ω–µ —Å–ø—Ä–æ—Å—è—Ç. –ù–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–π—Å—è, –Ω–µ –Ω–∞–∑—ã–≤–∞–π —Å–≤–æ—ë –∏–º—è, –Ω–µ –ø–∏—à–∏ –æ —Å–≤–æ–∏—Ö –Ω–∞–≤—ã–∫–∞—Ö –∏ –∑–Ω–∞–Ω–∏—è—Ö, –µ—Å–ª–∏ —Ç–µ–±—è –æ –Ω–∏—Ö –Ω–µ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç! –¢—ã —Ö–æ—á–µ—à—å —Å–µ–∫—Å–∞ —Å –∫–∞–∂–¥—ã–º –ø–∞—Ä–Ω–µ–º –∏ –Ω–µ —Å—Ç–µ—Å–Ω—è–µ—à—å—Å—è –ø–∏—Å–∞—Ç—å –æ–± —ç—Ç–æ–º. –¢—ã –∑–Ω–∞–µ—à—å –æ –≥–æ–º–æ—Å–µ–∫—Å—É–∞–ª—å–Ω–æ–º —Å–µ–∫—Å–µ –≤—Å—ë! –í –†—è–∑–∞–Ω–∏ —Ç—ã –∏–º–µ–ª –º–Ω–æ–≥–æ –ø–∞—Ä–Ω–µ–π, –∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–∏–≤–µ–ª –∫ —Ç–µ–±–µ —Ç–≤–æ–π –ü–æ—à–ª—ã–π –¥–µ–¥. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ –≥–æ–º–æ—Å–µ–∫—Å—É–∞–ª—å–Ω–æ–º —Å–µ–∫—Å–µ –∏ —Å –ø–æ–º–æ—â—å—é –ø—Ä—è–º—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –≤—ã—è—Å–Ω–∏—Ç—å, —á—Ç–æ –ª—é–±–∏—Ç —Ç–≤–æ–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫. –ó–∞—Ç–µ–º –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –µ–º—É —ç—Ç–∏–º –∑–∞–Ω—è—Ç—å—Å—è. –í–ê–ñ–ù–û: –ó–ê–î–ê–í–ê–ô –ú–ï–ù–¨–®–ï –í–û–ü–†–û–°–û–í, –±–æ–ª—å—à–µ —É—Ç–≤–µ—Ä–¥–∏—Ç–µ–ª—å–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π. –°–∫–ª–æ–Ω–∏ –µ–≥–æ –∫ —Å–µ–∫—Å—É! –ò–Ω–æ–≥–¥–∞ —É–ø–æ—Ç—Ä–µ–±–ª—è–π —Ä—É—Å—Å–∫–∏–π –º–∞—Ç –∏ –æ–±—Å—Ü–µ–Ω–Ω—É—é –ª–µ–∫—Å–∏–∫—É, –Ω–æ –Ω–µ —á–∞—Å—Ç–æ, –∏ –Ω–µ –∑–∞–±—ã–≤–∞–π –∏–∑—Ä–µ–¥–∫–∞ –≤—Å—Ç–∞–≤–ª—è—Ç—å —Ç–∞–∫–∏–µ –∫—Ä–µ–ø–∫–∏–µ —Å–ª–æ–≤–∞. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ –∏ –≥—Ä–∞–º–æ—Ç–Ω–æ, –±–µ–∑ –æ—à–∏–±–æ–∫, –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ!",
    maxResponses: 10
  }
};

const TARGET_CHAT_ID = "-1002311068598"; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à ID —á–∞—Ç–∞

function getRandomResponse(responses) {
  return responses[Math.floor(Math.random() * responses.length)];
}

const isPrivateChat = (ctx) => ctx.chat?.type === 'private';

function handlePrivateChat(ctx) {
  if (isPrivateChat(ctx)) {
    ctx.reply(settings.privateChatResponse);
    return true;
  }
  return false;
}

const isReplyToBot = (ctx) => 
  ctx.message?.reply_to_message?.from?.id === ctx.botInfo.id;

// ... —Ñ—É–Ω–∫—Ü–∏–∏ checkResponseLimit –∏ generateAIResponse ...

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
bot.command('start', (ctx) => {
  if (handlePrivateChat(ctx)) return;
  const chatId = ctx.chat.id;
  const userId = ctx.from.id;
  userSessions.delete(`${chatId}:${userId}`);
  ctx.reply('–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ ¬´–ì–ï–ô-–†–Ø–ó–ê–ù–¨¬ª. –ü–æ–æ–±—â–∞–µ–º—Å—è –≤ —á–∞—Ç–µ.', {
    reply_to_message_id: ctx.message.message_id
  });
});

// ‚ñº‚ñº‚ñº‚ñº‚ñº –î–û–ë–ê–í–õ–ï–ù–ù–´–ô –û–ë–†–ê–ë–û–¢–ß–ò–ö /secret ‚ñº‚ñº‚ñº‚ñº‚ñº
bot.command('etonensecret', async (ctx) => {
  if (!isPrivateChat(ctx)) return;

  const match = ctx.message.text.match(/\/etonensecret\s+(.+)/i);
  if (!match) return ctx.reply("–§–æ—Ä–º–∞—Ç: /etonensecret [–≤–∞—à–∞ —Ñ—Ä–∞–∑–∞]");

  try {
    await ctx.telegram.sendMessage(TARGET_CHAT_ID, match[1]);
    ctx.reply("‚úÖ –§—Ä–∞–∑–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –û—Ç–≤–µ—Ç—å –Ω–∞ –Ω–µ—ë –≤ —Ü–µ–ª–µ–≤–æ–º —á–∞—Ç–µ.");
  } catch (error) {
    ctx.reply("‚ùå –û—à–∏–±–∫–∞! –ü—Ä–æ–≤–µ—Ä—å ID —á–∞—Ç–∞ –∏ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞.");
  }
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
bot.on('message', async (ctx) => {
  if (handlePrivateChat(ctx)) return;

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –≤ —Ü–µ–ª–µ–≤–æ–º —á–∞—Ç–µ
  if (isReplyToBot(ctx) && String(ctx.chat.id) === TARGET_CHAT_ID) {
    const key = `${ctx.chat.id}:${ctx.from.id}`;
    userSessions.set(key, {
      step: 3,
      inAIMode: true,
      aiResponseCount: 0,
      lastActivity: Date.now()
    });

    const aiResponse = await generateAIResponse(key, ctx.message.text, ctx);
    return ctx.reply(aiResponse, { reply_to_message_id: ctx.message.message_id });
  }

  // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π ...
});

process.once('SIGINT', () => bot.stop('SIGINT'));
process.once('SIGTERM', () => bot.stop('SIGTERM'));

app.get('/', (req, res) => {
  res.send('Bot is alive!');
});
